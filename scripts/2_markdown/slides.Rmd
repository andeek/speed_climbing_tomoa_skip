---
title: "The Fast and the Furious: Tracking the Effect of the Tomoa Skip on Speed Climbing"
output: ioslides_presentation
date: "2023-06-09"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

## load required libraries and data
library(ggplot2)
library(dplyr)
library(tidyr)
library(cowplot)

load("../../data/mTimes_skip.Rdata")
load("../../data/wTimes_skip.Rdata")
```

## Best Times Per Event
```{r message=FALSE, warning=FALSE}
m_times_update |>
  bind_rows(w_times_update) |>
  pivot_longer(cols = c("best_qual", "final", "lane_a", "lane_b", "first_round", "quarter", "semi", "small_final", "big_final"), names_to = "round", values_to = "time") |>
  group_by(fname, lname, tomoa_skip, sex, event_id, year, start_date) |>
  summarise(best_time = if (all(is.na(time))) NA else min(time, na.rm = TRUE)) |>
  filter(!is.na(best_time)) |>
  ggplot() +
  geom_jitter(aes(start_date, best_time, color = tomoa_skip)) +
  facet_wrap(.~sex) + 
  ggtitle("Best Time Per Event") + 
  labs(x = "Start Date", y = "Best Time")
```

<div class="notes">
- Always large outliers in 2012
- Typically hump in 2018 (olympic announcement in 2016)
- Is using best_qual w/ lane_a and lane_b OK?
</div>

## All Qualifier Times: Mens and Womens 
``` {r message = FALSE, warning = FALSE}
m_times_update |>
  bind_rows(w_times_update) |>
  pivot_longer(cols = c("best_qual", "lane_a", "lane_b"), names_to = "round", values_to = "qual_time") |>
  group_by(fname, lname, tomoa_skip, sex, event_id, year, start_date) |>
  filter(!is.na(qual_time)) |>
  ggplot() +
  geom_jitter(aes(start_date, qual_time, color = tomoa_skip)) + 
  facet_wrap(.~sex) + 
  coord_cartesian(ylim = c(0, 40)) + 
  ggtitle("Qualifying Times for Men and Women") +
  labs(x = "Start Date", y = "Qualifier Time") 
```

<div class="notes">
- Similar slight downwards trend in terms of minimum times in each "cluster"
- Women's fluctuates slightly more than mens
- OK to limit y axis? 
</div>

## All Final Times: Mens and Womens
``` {r message = FALSE, warning = FALSE}
m_times_update |>
  bind_rows(w_times_update) |>
  pivot_longer(cols = c("final", "first_round", "quarter", "semi", "small_final", "big_final"), names_to = "round", values_to = "final_time") |>
  group_by(fname, lname, sex, tomoa_skip, event_id, year, start_date) |>
  filter(!is.na(final_time)) |>
  ggplot() +
  geom_jitter(aes(start_date, final_time, color = tomoa_skip)) + 
  facet_wrap(.~sex) + 
  coord_cartesian(ylim = c(0, 40)) + 
  ggtitle("Final Times for Men and Women") + 
  labs(x = "Start Date", y = "Final Time")
```


<div class="notes">
- Womens has more dramatic shift in min times from 2012 - 2022
</div>

## Mens Qualifier vs Final times
``` {r message = FALSE, warning = FALSE, results = 'hide'}
# Mens qualifier times 
qual_plot <-m_times_update |>
  pivot_longer(cols = c("best_qual", "lane_a", "lane_b"), names_to = "round", values_to = "qual_time") |>
  group_by(fname, lname, tomoa_skip, sex, event_id, year, start_date) |>
  filter(!is.na(qual_time))  |>
  ggplot() +
  geom_jitter(aes(start_date, qual_time, color = tomoa_skip), show.legend = FALSE) + 
  coord_cartesian(ylim = c(0, 40)) + 
  ggtitle("Qualifying Times for Men") + 
  labs(x = "Start Date", y = "Qualifier Time") + 
  theme(legend.position = "none")

# Mens final times
final_plot <- m_times_update |>
  pivot_longer(cols = c("final", "first_round", "quarter", "semi", "small_final", "big_final"), names_to = "round", values_to = "final_time") |>
  group_by(fname, lname, sex, tomoa_skip, event_id, year, start_date) |>
  # There are 3 outliers of ~100 seconds
  filter(!is.na(final_time))  |>
  ggplot() +
  geom_jitter(aes(start_date, final_time, color = tomoa_skip), show.legend = FALSE) + 
  coord_cartesian(ylim = c(0, 40)) + 
  ggtitle("Final Times for Men") + 
  labs(x = "Start Date", y = "Qualifier Time") 

#Combine two plots
plot_grid(qual_plot, final_plot, ncol = 2)

```

## Womens Qualifier Vs Final Times
``` {r message = FALSE, warning = FALSE, results = 'hide'}
# Womens qualifier times 
qual_plot <-w_times_update |>
  pivot_longer(cols = c("best_qual", "lane_a", "lane_b"), names_to = "round", values_to = "qual_time") |>
  group_by(fname, lname, tomoa_skip, sex, event_id, year, start_date) |>
  filter(!is.na(qual_time))  |>
  ggplot() +
  # Hiding legends to prevent compressing
  geom_jitter(aes(start_date, qual_time, color = tomoa_skip), show.legend = FALSE) + 
  coord_cartesian(ylim = c(0, 40)) + 
  ggtitle("Qualifying Times for Women") + 
  theme(legend.position = "none") + 
  labs(x = "Start Date", y = "Qualifier Time")

# Womens final times
final_plot <- w_times_update |>
  pivot_longer(cols = c("final", "first_round", "quarter", "semi", "small_final", "big_final"), names_to = "round", values_to = "final_time") |>
  group_by(fname, lname, sex, tomoa_skip, event_id, year, start_date) |>
  filter(!is.na(final_time))  |>
  ggplot() +
  geom_jitter(aes(start_date, final_time, color = tomoa_skip), show.legend = FALSE) + 
  coord_cartesian(ylim = c(0, 40)) + 
  ggtitle("Final Times for Women") + 
  labs(x = "Start Date", y = "Final Time")

plot_grid(qual_plot, final_plot, ncol = 2)
```

<div class="notes">
- Similar trend between final and qual times, more obvious than mens
</div>

## Users of Tomoa skip

```{r message = FALSE, warning = FALSE}
# Number of tomoa skip users per start date
m_times_update |>
  bind_rows(w_times_update) |>
  group_by(sex, start_date) |>
  filter(!is.na(tomoa_skip)) |>
  summarise(num_ts = sum(tomoa_skip), num_no_ts = sum(!tomoa_skip)) |>
  ggplot() +
  geom_point(aes(start_date, num_ts, color = "num_ts")) + 
  geom_point(aes(start_date, num_no_ts, color = "num_no_ts")) + 
  facet_wrap(.~sex) +
  ggtitle("Uses of tomoa skip per date") + 
  labs(x="Start Date", y = "Count")
```

<div class = "notes">
- Not sure how useful this is
- Mens and womens follow similar patterns
</div>




